<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' data:; img-src 'self' data: blob: https:; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; connect-src 'self' data:">
    <title>AVANT</title>
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/macro-builder.css">
</head>
<body>
    <div id="app" class="h-screen flex bg-slate-50">
        <!-- Main Content - 3 Column Layout -->
        <div class="flex-1 flex overflow-hidden">
            <!-- Left Panel - Screen Preview (flex-[5]) -->
            <div class="flex-[5] bg-white border-r flex flex-col relative">
                <!-- Device Status - Positioned at top right -->
                <div class="absolute top-4 right-4 z-10 device-status-container" id="device-status">
                    <!-- Device status will be rendered here when connected -->
                </div>

                <div class="flex-1 overflow-auto p-6" id="screen-preview-container">
                    <!-- Device Connection UI (shown when no device connected) -->
                    <div id="device-connection-ui" class="device-connection-container">
                        <div class="device-connection-content">
                            <svg class="device-connection-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                            </svg>
                            <h3 class="device-connection-title">장치 연결이 필요합니다</h3>
                            <p class="device-connection-description">AVN 검증을 시작하려면 테스트 장치를 연결하세요</p>

                            <div class="device-connection-methods">
                                <div class="device-method-card">
                                    <div class="device-method-header">
                                        <svg class="device-method-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                        </svg>
                                        <div>
                                            <h4 class="device-method-title">ADB 장치</h4>
                                            <p class="device-method-description">connect-S</p>
                                        </div>
                                    </div>
                                    <button class="device-connect-button" id="btn-connect-adb">
                                        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                        ADB 연결
                                    </button>
                                </div>

                                <div class="device-method-card">
                                    <div class="device-method-header">
                                        <svg class="device-method-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                        </svg>
                                        <div>
                                            <h4 class="device-method-title">iSAP 장치</h4>
                                            <p class="device-method-description">ccNC, ccRC, ccIC 등</p>
                                        </div>
                                    </div>
                                    <button class="device-connect-button" id="btn-connect-isap">
                                        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                        iSAP 연결
                                    </button>
                                </div>
                            </div>

                            <div class="device-connection-note">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span>장치를 USB로 연결하거나 무선 네트워크에서 연결 가능합니다</span>
                            </div>
                        </div>
                    </div>
                    <!-- Screen preview will be rendered here when device connected -->
                </div>
            </div>

            <!-- Middle Panel - Macro Sequence (flex-[3]) -->
            <div class="flex-[3] bg-slate-50 flex flex-col" id="macro-sequence-container">
                <!-- Header with Macro Name and Controls -->
                <div class="px-6 py-4 bg-white border-b">
                    <div class="flex items-center justify-between mb-3">
                        <input
                            type="text"
                            id="macro-name-input"
                            class="text-lg max-w-xs border-0 px-0 focus-visible:ring-0 macro-name-input"
                            placeholder="시나리오 이름"
                            value="새 시나리오"
                        />
                    </div>
                    <div class="flex items-center gap-2">
                        <button class="btn-outline btn-sm" id="btn-import-macro">
                            <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            불러오기
                        </button>
                        <input
                            id="import-input-seq"
                            type="file"
                            accept=".json"
                            class="hidden"
                        />
                        <button class="btn-outline btn-sm" id="btn-export-macro">
                            <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                            </svg>
                            내보내기
                        </button>
                        <button class="btn-outline btn-sm" id="btn-save-macro">
                            <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                            </svg>
                            저장
                        </button>
                        <button class="btn-primary btn-sm ml-auto" id="btn-run-macro">
                            <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            실행
                        </button>
                    </div>
                </div>

                <!-- Action List -->
                <div class="flex-1 overflow-auto p-6" id="action-sequence-list">
                    <!-- Empty state -->
                    <div class="empty-state" id="empty-state">
                        <svg class="empty-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <p class="empty-title">시나리오가 비어있습니다</p>
                        <p class="empty-description">오른쪽에서 액션을 선택하여 시작하세요</p>
                    </div>
                    <!-- Action blocks will be rendered here -->
                </div>
            </div>

            <!-- Right Panel - Action List (flex-[2]) -->
            <div class="flex-[2] bg-white border-l flex flex-col">
                <div class="px-6 py-4 border-b">
                    <h2 class="text-slate-900">액션 추가</h2>
                    <p class="text-sm text-slate-600">매크로에 추가할 액션 선택</p>
                </div>
                <div class="flex-1 overflow-auto p-6" id="action-list-container">
                    <!-- Options Box -->
                    <div class="options-box mb-4">
                        <div class="options-box-content">
                            <div class="option-item">
                                <div class="option-label">
                                    <svg class="option-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>즉시 실행</span>
                                    <div class="option-info">
                                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <span class="option-tooltip">액션을 추가할 때 바로 장치에 전송하여 실행합니다. 다음 페이지를 보면서 매크로를 작성할 수 있습니다.</span>
                                    </div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="option-instant-execute" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="option-item">
                                <div class="option-label">
                                    <svg class="option-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span>지연 시간</span>
                                    <div class="option-info">
                                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <span class="option-tooltip">각 액션 실행 후 대기할 시간을 설정합니다.</span>
                                    </div>
                                </div>
                                <select class="option-select" id="option-delay">
                                    <option value="0">없음</option>
                                    <option value="100">100ms</option>
                                    <option value="300" selected>300ms</option>
                                    <option value="500">500ms</option>
                                    <option value="1000">1000ms</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Tabs -->
                    <div class="tabs mb-4">
                        <div class="tabs-list grid grid-cols-4">
                            <button class="tab active" data-tab="basic">기본</button>
                            <button class="tab" data-tab="system">시스템</button>
                            <button class="tab" data-tab="image">이미지</button>
                            <button class="tab" data-tab="logic">로직</button>
                        </div>
                    </div>

                    <!-- Tab Contents -->
                    <div class="tab-content active" data-tab="basic" id="basic-actions">
                        <!-- Basic actions will be rendered here -->
                    </div>
                    <div class="tab-content hidden" data-tab="system" id="system-actions">
                        <!-- System actions will be rendered here -->
                    </div>
                    <div class="tab-content hidden" data-tab="image" id="image-actions">
                        <!-- Image actions will be rendered here -->
                    </div>
                    <div class="tab-content hidden" data-tab="logic" id="logic-actions">
                        <!-- Logic actions will be rendered here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Stores -->
    <script src="stores/DeviceStore.js"></script>
    <script src="stores/ScreenStore.js"></script>
    <script src="stores/MacroStore.js"></script>
    <script src="stores/ActionStore.js"></script>

    <!-- Services -->
    <script src="services/EventBus.js"></script>
    <script src="services/IPCService.js"></script>

    <!-- Main App -->
    <script src="macro-builder-app.js"></script>
</body>
</html>
