<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Action Extensibility Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        h1 { color: #2563eb; }
        h2 { color: #64748b; margin-top: 30px; }
        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .plugin-card {
            border: 2px solid #e2e8f0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            transition: border-color 0.2s;
        }
        .plugin-card:hover {
            border-color: #2563eb;
        }
        .plugin-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .plugin-icon {
            font-size: 24px;
        }
        .plugin-name {
            font-size: 18px;
            font-weight: bold;
        }
        .plugin-category {
            display: inline-block;
            padding: 4px 8px;
            background: #e0e7ff;
            color: #3730a3;
            border-radius: 4px;
            font-size: 12px;
            margin-left: auto;
        }
        .plugin-description {
            color: #64748b;
            margin: 5px 0;
        }
        .plugin-fields {
            margin-top: 10px;
            padding-left: 20px;
        }
        .field {
            font-size: 13px;
            color: #475569;
            margin: 3px 0;
        }
        .success {
            color: #16a34a;
            font-weight: bold;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #f8fafc;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #2563eb;
        }
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #2563eb;
        }
        .stat-label {
            font-size: 14px;
            color: #64748b;
            margin-top: 5px;
        }
        .code {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }
        .highlight { color: #fbbf24; }
    </style>
</head>
<body>
    <h1>Action Extensibility Test</h1>

    <div class="section">
        <h2>System Overview</h2>
        <p>This demonstrates the Action Plugin System - an extensible architecture for adding new action types to Vision Auto.</p>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="total-actions">0</div>
                <div class="stat-label">Total Action Types</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="core-actions">0</div>
                <div class="stat-label">Core Actions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="plugin-actions">0</div>
                <div class="stat-label">Plugin Actions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="categories">0</div>
                <div class="stat-label">Categories</div>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>Registered Plugins</h2>
        <div id="plugins-list"></div>
    </div>

    <div class="section">
        <h2>How to Add a New Action Type</h2>
        <div class="code">
<span class="highlight">// 1. Define plugin</span>
const myPlugin = {
    type: 'my-action',
    name: 'My Custom Action',
    category: 'custom',
    description: 'Does something amazing',
    icon: '‚≠ê',
    color: '#2563eb',

    fields: [
        { name: 'param1', type: 'text', label: 'Parameter 1', required: true }
    ],

    defaultParams: { param1: '' },

    async executor(action, context) {
        // Your implementation here
        return { message: 'Success!' };
    }
};

<span class="highlight">// 2. Register plugin</span>
actionPluginSystem.registerPlugin(myPlugin);

<span class="highlight">// 3. Done! Action is now available</span>
        </div>
    </div>

    <div class="section">
        <h2>Benefits</h2>
        <ul>
            <li><strong>Zero Core Changes:</strong> Add new actions without modifying core code</li>
            <li><strong>Hot Reload:</strong> Register plugins at runtime</li>
            <li><strong>Type Safety:</strong> Validation ensures correct structure</li>
            <li><strong>Metadata Rich:</strong> Full configuration for UI rendering</li>
            <li><strong>Execution Isolation:</strong> Plugins run in isolation with error handling</li>
            <li><strong>Easy Distribution:</strong> Plugins can be distributed as separate files</li>
        </ul>
    </div>

    <!-- Load Services -->
    <script src="src/renderer/services/ActionConfigProvider.js"></script>
    <script src="src/renderer/services/ActionPluginSystem.js"></script>

    <script>
        // Initialize systems
        const actionConfig = new ActionConfigProvider();
        const pluginSystem = new ActionPluginSystem(actionConfig);

        // Count core actions
        const coreActionTypes = actionConfig.getAllActionTypes();
        const coreCount = coreActionTypes.length;

        // Register example plugins
        const examplePlugins = [
            {
                type: 'screenshot',
                name: 'Take Screenshot',
                category: 'advanced',
                description: 'Capture and save screenshot',
                icon: 'üì∏',
                color: '#8b5cf6',
                fields: [
                    { name: 'filename', type: 'text', label: 'File Name', required: true },
                    { name: 'format', type: 'select', label: 'Format', required: true, options: ['png', 'jpeg'] }
                ],
                defaultParams: { filename: 'screenshot', format: 'png' },
                executionTime: 500,
                executor: async (action, context) => ({ message: 'Screenshot captured!' })
            },
            {
                type: 'ocr',
                name: 'OCR Text Recognition',
                category: 'vision',
                description: 'Extract text from screen using OCR',
                icon: 'üî§',
                color: '#ec4899',
                fields: [
                    { name: 'region', type: 'region', label: 'Search Region', required: false },
                    { name: 'language', type: 'select', label: 'Language', required: true, options: ['eng', 'kor'] }
                ],
                defaultParams: { region: null, language: 'eng' },
                executionTime: 2000,
                executor: async (action, context) => ({ message: 'Text recognized!' })
            },
            {
                type: 'accessibility',
                name: 'Accessibility Action',
                category: 'advanced',
                description: 'Interact with elements using accessibility features',
                icon: '‚ôø',
                color: '#0891b2',
                fields: [
                    { name: 'selector', type: 'text', label: 'Accessibility ID', required: true },
                    { name: 'action', type: 'select', label: 'Action', required: true, options: ['tap', 'scroll'] }
                ],
                defaultParams: { selector: '', action: 'tap' },
                executor: async (action, context) => ({ message: 'Action performed!' })
            },
            {
                type: 'performance',
                name: 'Performance Monitor',
                category: 'testing',
                description: 'Monitor app performance metrics',
                icon: 'üìä',
                color: '#f59e0b',
                fields: [
                    { name: 'duration', type: 'number', label: 'Monitor Duration (ms)', required: true, min: 1000 }
                ],
                defaultParams: { duration: 5000 },
                executor: async (action, context) => ({ message: 'Monitoring complete!' })
            },
            {
                type: 'gesture-record',
                name: 'Record Gesture',
                category: 'advanced',
                description: 'Record and replay complex gestures',
                icon: '‚úçÔ∏è',
                color: '#10b981',
                fields: [
                    { name: 'gestureName', type: 'text', label: 'Gesture Name', required: true },
                    { name: 'duration', type: 'number', label: 'Recording Duration (ms)', required: true }
                ],
                defaultParams: { gestureName: 'custom_gesture', duration: 5000 },
                executor: async (action, context) => ({ message: 'Gesture recorded!' })
            }
        ];

        // Register all plugins
        examplePlugins.forEach(plugin => {
            try {
                pluginSystem.registerPlugin(plugin);
            } catch (error) {
                console.error(`Failed to register plugin ${plugin.type}:`, error);
            }
        });

        // Update statistics
        const allActionTypes = actionConfig.getAllActionTypes();
        const categories = actionConfig.getAllCategories();

        document.getElementById('total-actions').textContent = allActionTypes.length;
        document.getElementById('core-actions').textContent = coreCount;
        document.getElementById('plugin-actions').textContent = examplePlugins.length;
        document.getElementById('categories').textContent = categories.length;

        // Render plugins
        const pluginsList = document.getElementById('plugins-list');
        const plugins = pluginSystem.listPlugins();

        plugins.forEach(plugin => {
            const card = document.createElement('div');
            card.className = 'plugin-card';
            card.style.borderLeftColor = plugin.color;

            const header = document.createElement('div');
            header.className = 'plugin-header';
            header.innerHTML = `
                <span class="plugin-icon">${plugin.icon}</span>
                <span class="plugin-name">${plugin.name}</span>
                <span class="plugin-category">${plugin.category}</span>
            `;

            const description = document.createElement('div');
            description.className = 'plugin-description';
            description.textContent = plugin.description;

            const fields = document.createElement('div');
            fields.className = 'plugin-fields';
            fields.innerHTML = `<strong>Fields:</strong> ${plugin.fields.map(f => f.label).join(', ') || 'None'}`;

            card.appendChild(header);
            card.appendChild(description);
            card.appendChild(fields);

            pluginsList.appendChild(card);
        });

        console.log('‚úÖ Action Extensibility Test Complete!');
        console.log('Core Actions:', coreCount);
        console.log('Plugin Actions:', examplePlugins.length);
        console.log('Total Actions:', allActionTypes.length);
    </script>
</body>
</html>
